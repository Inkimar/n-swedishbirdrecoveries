---
title: "Using Swedish Bird Recoveries Data and Visuals"
author: ""
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette:
    fig_caption: yes
vignette: >
  %\VignetteIndexEntry{Using Swedish Bird Recoveries Data and Visuals}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, echo = FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#>")
```

![Photo: Staffan Waerndt](fig/birds.jpg)

We start by showing how to load the package and to retrieve data. 

## Latest bird recoveries

The first example shows the ten latest recoveries, arranged by recovery date and we also restrict the set of available column by selecting only three columns to display; the scientific name of the bird, the recovery date and a description of the determined cause for the recovery.

```{r, echo=TRUE, results='asis'}
# to load the package fairly silently we wrap the call to load the
# library in the suppressPackageStartupMessages function
suppressPackageStartupMessages(library(swedishbirdrecoveries))

# display data for the first ten rows and select three columns
library(dplyr)

df <- birdrecoveries %>% 
  arrange(desc(recovery_date)) %>%
  select(sciname, recovery_date, recovery_det) %>%
  head(10)

knitr::kable(df)
```

# What dimensions are available?

The available columns in the data provide dimensions that cover many of the 5W questions:

- WHAT - taxonomy (name, sciname) including gender/sex (ringing_sex_code, ringing_sex, recovery_sex_code, recovery_sex)
- WHEN - temporal/age/duration (ringing_age_code, ringing_age, ringing_date, etc)
- WHERE - location/accurary - numerical and categorical (ringing_lot, ringing_lon, recovery_lat, recovery_lon, ringing_country, ringing_province, recovery_majorregion, recovery_minorregion, ringing_accu2 etc)
- WHY/HOW - recovery event data (distance, direction, days, hours, recovery_code, recovery_det)

The help functions provide detailed metadata information for the bundled datasets. For example, you can get more details in the help for the `birdrecoveries_eng` dataset, which contains the following columns:

```{r, echo=TRUE, results='asis'}
colnames <- data_frame(colname = names(birdrecoveries_eng))
knitr::kable(colnames)
```

# Filter data using taxonomy

You may need to filter the data, given certain criteria related to the taxonomy. For example, you may want to remove or focus on certain taxa. 

Matching taxonomic names may be needed in order to make reasonable efforts towards avoiding to compare apples with oranges. 

A package called `taxize` can be used for this purpose. Here this package is used to link out to Encyclopedia of Life pages that are available for species in the dataset.

```{r, echo=TRUE, results='asis', warning=FALSE, message=FALSE}
library(taxize)
library(pander)

#eubon(query = species[1], searchMode = "scientificNameExact")

#res <- resolve(query = species, 
#  source = "GBIF Backbone Taxonomy", 
#  config = progress())

species <- birdrecoveries %>% select(sciname) %>% unique %>% .$sciname
first_row <- function(x) eol_search(x) %>% head(1)
res <- purrr::map_df(species, first_row)
pages <- paste0("[", res$name, "](http://eol.org/pages/", res$pageid, ")\n")
out <- data_frame(sciname = species, eol = pages)

pander(out)

```

How can we focus on protected species in Sweden, if we knew the vernacular names below together can lead to the set of scientific names that would be relevant to use?

### Rovfåglar 

Fiskgjuse, bivråk, örnar, glador, falkar och kärrhökar. 

### Ugglor

Tornuggla, hökuggla, berguv, fjälluggla, lappuggla och slaguggla. 

### Hackspettar 

Gråspett, vitryggig hackspett och mellanspett. 

### Tärnor 

Skräntärna och svarttärna.

### Övriga fåglar

Fjällgås, storkar, rördrom, lunnefågel, salskrake, svarthalsad dopping, skärfläcka, kungsfiskare, blåkråka, härfågel och sommargylling. 
